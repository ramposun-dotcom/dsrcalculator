<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DSR ê³„ì‚°ê¸° - by ì§„ë§ˆìŠ¤í„°</title>
  <style>
    :root {
      --bg-gradient-start: #4f46e5;
      --bg-gradient-end: #ec4899;
      --bg-soft: #f9fafb;
      --card-bg: #ffffff;
      --card-border: #e5e7eb;
      --text-main: #0f172a;
      --text-sub: #6b7280;
      --accent: #4f46e5;
      --accent-soft: #eef2ff;
      --safe: #16a34a;
      --warning: #f97316;
      --danger: #e11d48;
    }

    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
      min-height: 100%;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Noto Sans KR", "Segoe UI", system-ui, sans-serif;
      background: radial-gradient(circle at top left, rgba(248,250,252,0.9) 0, #f9fafb 40%, #f3f4f6 100%);
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
    }

    .page {
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 32px 16px;
    }

    .shell {
      max-width: 1120px;
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .hero {
      border-radius: 24px;
      padding: 22px 24px;
      background: linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end));
      color: #f9fafb;
      box-shadow: 0 24px 50px rgba(15,23,42,0.35);
    }

    .hero-title {
      font-size: 26px;
      font-weight: 800;
      margin: 0 0 10px 0;
    }

    .card {
      border-radius: 20px;
      background: var(--card-bg);
      box-shadow: 0 18px 40px rgba(15,23,42,0.08);
      border: 1px solid rgba(148,163,184,0.20);
      padding: 20px;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      margin: 15px 0 8px 0;
    }

    .field-row {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      align-items: center;
    }

    .field-label {
      min-width: 100px;
      font-size: 13px;
    }

    .field-input {
      flex: 1;
    }

    .field-input input {
      width: 100%;
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid #d4d4dd;
      font-size: 13px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }

    th, td {
      padding: 8px;
      border: 1px solid #e5e7eb;
      text-align: center;
    }

    th {
      background: #f3f4f6;
      font-weight: 600;
    }

    td input {
      width: 100%;
      padding: 6px;
      border: 1px solid #d4d4dd;
      border-radius: 4px;
    }

    .controls {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 15px;
    }

    button {
      padding: 8px 16px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
    }

    .btn-outline {
      background: white;
      border: 1px solid #d4d4dd;
    }

    .results {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
      padding: 15px;
      background: #f9fafb;
      border-radius: 12px;
    }

    .result-label {
      font-size: 12px;
      color: var(--text-sub);
      margin-bottom: 5px;
    }

    .result-value {
      font-size: 16px;
      font-weight: 600;
    }

    .dsr-number {
      font-size: 24px;
      font-weight: 700;
    }

    .dsr-safe { color: var(--safe); }
    .dsr-warning { color: var(--warning); }
    .dsr-danger { color: var(--danger); }

    @media (max-width: 768px) {
      .page { padding: 15px 10px; }
      .results { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="shell">
      <!-- Hero -->
      <section class="hero">
        <h1 class="hero-title">DSR ê³„ì‚°ê¸°</h1>
        <p style="margin: 0; font-size: 14px;">ì—° ì†Œë“ê³¼ ëŒ€ì¶œ ì •ë³´ë¥¼ ì…ë ¥í•˜ì—¬ DSRì„ ê³„ì‚°í•˜ì„¸ìš”.</p>
      </section>

      <!-- Calculator -->
      <section class="card">
        <div class="section-title">1. ì†Œë“ ì…ë ¥</div>
        
        <div class="field-row">
          <div class="field-label">ì—° ì†Œë“</div>
          <div class="field-input">
            <input type="text" id="annualIncome" placeholder="ì˜ˆ: 80000000">
          </div>
        </div>

        <div class="field-row">
          <div class="field-label">ê¸°ì¡´ ë¶€ì±„(í•©ì‚°)</div>
          <div class="field-input">
            <input type="text" id="existingDebt" placeholder="ì˜ˆ: 480000000">
          </div>
        </div>

        <div class="field-row">
          <div class="field-label">ì„œìš¸ë³´ì¦ ì ìš©ê¸ˆë¦¬</div>
          <div class="field-input">
            <input type="number" id="sgiRate" value="5" step="0.1">
          </div>
        </div>

        <div class="section-title">2. ëŒ€ì¶œ ì •ë³´ ì…ë ¥</div>
        
        <table>
          <thead>
            <tr>
              <th>ëŒ€ì¶œ ì¢…ë¥˜</th>
              <th>ëŒ€ì¶œ ì›ê¸ˆ</th>
              <th>ì—° ì´ììœ¨(%)</th>
              <th>ê¸°ê°„(ë…„)</th>
              <th>ì—°ê°„ ìƒí™˜ì•¡</th>
            </tr>
          </thead>
          <tbody id="loanTableBody"></tbody>
        </table>

        <div class="controls">
          <button class="btn-outline" onclick="addLoanRow()">+ í–‰ ì¶”ê°€</button>
          <button class="btn-outline" onclick="exportToExcel()">ğŸ“Š ì—‘ì…€</button>
          <button class="btn-outline" onclick="clearAll()">ì´ˆê¸°í™”</button>
          <button class="btn-primary" onclick="calculateDSR()">ê³„ì‚°í•˜ê¸°</button>
        </div>

        <div class="section-title">3. ê²°ê³¼</div>
        
        <div class="results">
          <div>
            <div class="result-label">ì´ ì—°ê°„ ìƒí™˜ì•¡</div>
            <div class="result-value" id="totalAnnualPayment">0ì›</div>
          </div>
          <div>
            <div class="result-label">DSR</div>
            <div class="dsr-number" id="dsrValue">0.00%</div>
          </div>
          <div>
            <div class="result-label">ì„œìš¸ë³´ì¦ DTI</div>
            <div class="dsr-number" id="sgiDtiValue">0.00%</div>
          </div>
          <div>
            <div class="result-label">ì§„ë‹¨</div>
            <div class="result-value" id="dsrComment">ê³„ì‚° ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <script>
    const defaultLoans = [
      "ì£¼íƒë‹´ë³´ëŒ€ì¶œ 1", "ì£¼íƒë‹´ë³´ëŒ€ì¶œ 2", "ì‹ ìš©ëŒ€ì¶œ 1", 
      "ì‹ ìš©ëŒ€ì¶œ 2", "ì „ì„¸ìê¸ˆëŒ€ì¶œ"
    ];

    function parseMoney(str) {
      if (!str) return 0;
      return Number(str.toString().replace(/[^0-9]/g, '') || 0);
    }

    function formatNumber(num) {
      return Math.round(num).toLocaleString('ko-KR');
    }

    function createLoanRow(name = '') {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="text" value="${name}" placeholder="ëŒ€ì¶œ ì¢…ë¥˜"></td>
        <td><input type="text" placeholder="ì›ê¸ˆ"></td>
        <td><input type="number" placeholder="ì´ììœ¨" step="0.01"></td>
        <td><input type="number" placeholder="ê¸°ê°„"></td>
        <td><input type="text" readonly placeholder="ìë™ê³„ì‚°"></td>
      `;
      return tr;
    }

    function addLoanRow(name = '') {
      document.getElementById('loanTableBody').appendChild(createLoanRow(name));
    }

    function initDefaultRows() {
      const tbody = document.getElementById('loanTableBody');
      tbody.innerHTML = '';
      defaultLoans.forEach(label => addLoanRow(label));
    }

    function calcAnnualPayment(principal, annualRate, years) {
      if (principal <= 0 || years <= 0) return 0;
      if (annualRate === 0) return principal / years;
      const pow = Math.pow(1 + annualRate, years);
      return principal * annualRate * pow / (pow - 1);
    }

    function calculateDSR() {
      const annualIncome = parseMoney(document.getElementById('annualIncome').value);
      const existingDebt = parseMoney(document.getElementById('existingDebt').value);
      const sgiRate = Number(document.getElementById('sgiRate').value) / 100;

      const rows = document.querySelectorAll('#loanTableBody tr');
      let totalAnnualPayment = 0;
      let plannedMortgageAnnualPayment = 0;

      rows.forEach(row => {
        const inputs = row.querySelectorAll('input');
        const loanName = inputs[0].value.trim();
        const principal = parseMoney(inputs[1].value);
        const rate = Number(inputs[2].value) / 100;
        const years = Number(inputs[3].value);

        const annualPayment = calcAnnualPayment(principal, rate, years);
        inputs[4].value = annualPayment > 0 ? formatNumber(annualPayment) + 'ì›' : '';
        
        totalAnnualPayment += annualPayment;
        
        if (loanName.includes('ì£¼íƒë‹´ë³´')) {
          plannedMortgageAnnualPayment += annualPayment;
        }
      });

      document.getElementById('totalAnnualPayment').textContent = formatNumber(totalAnnualPayment) + 'ì›';

      let dsr = 0;
      if (annualIncome > 0) {
        dsr = (totalAnnualPayment / annualIncome) * 100;
      }

      const dsrEl = document.getElementById('dsrValue');
      dsrEl.textContent = dsr.toFixed(2) + '%';
      dsrEl.className = 'dsr-number';
      
      if (dsr < 30) dsrEl.classList.add('dsr-safe');
      else if (dsr < 40) dsrEl.classList.add('dsr-warning');
      else dsrEl.classList.add('dsr-danger');

      let sgiDti = 0;
      if (annualIncome > 0) {
        sgiDti = ((plannedMortgageAnnualPayment + (existingDebt * sgiRate)) / annualIncome) * 100;
      }
