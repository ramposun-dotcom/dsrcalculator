<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>DSR 계산기</title>
  <style>
    :root {
      --bg-gradient-start: #4f46e5;
      --bg-gradient-end: #ec4899;
      --bg-soft: #f9fafb;
      --card-bg: #ffffff;
      --card-border: #e5e7eb;
      --text-main: #0f172a;
      --text-sub: #6b7280;
      --accent: #4f46e5;
      --accent-soft: #eef2ff;
      --safe: #16a34a;
      --warning: #f97316;
      --danger: #e11d48;
    }

    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
      min-height: 100%;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Noto Sans KR", "Segoe UI", system-ui, sans-serif;
      background:
        radial-gradient(circle at top left, rgba(248,250,252,0.9) 0, #f9fafb 40%, #f3f4f6 100%);
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
    }

    .page {
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 32px 16px;
    }

    .shell {
      max-width: 1120px;
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    /* Hero 영역 */
    .hero {
      border-radius: 24px;
      padding: 22px 24px;
      background: linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end));
      color: #f9fafb;
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1fr);
      gap: 20px;
      box-shadow:
        0 24px 50px rgba(15,23,42,0.35);
      position: relative;
      overflow: hidden;
    }

    .hero::before,
    .hero::after {
      content: "";
      position: absolute;
      border-radius: 999px;
      filter: blur(0);
      opacity: 0.18;
      pointer-events: none;
    }

    .hero::before {
      width: 260px;
      height: 260px;
      background: radial-gradient(circle, #ffffff 0, #bfdbfe 40%, transparent 70%);
      top: -60px;
      right: -40px;
    }

    .hero::after {
      width: 200px;
      height: 200px;
      background: radial-gradient(circle, #f9a8d4 0, transparent 70%);
      bottom: -60px;
      left: 40%;
    }

    .hero-left {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .hero-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 10px;
      border-radius: 999px;
      background: rgba(15,23,42,0.25);
      backdrop-filter: blur(6px);
      font-size: 11px;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    .hero-pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #22c55e;
    }

    .hero-title {
      font-size: 26px;
      font-weight: 800;
      letter-spacing: -0.04em;
      line-height: 1.25;
    }

    .hero-title span.accent {
      color: #fefce8;
      text-shadow: 0 0 18px rgba(15,23,42,0.4);
    }

    .hero-subtitle {
      font-size: 13px;
      color: #e5e7eb;
      max-width: 440px;
      line-height: 1.6;
    }

    .hero-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
      font-size: 11px;
      color: #e5e7eb;
      opacity: 0.9;
    }

    .hero-tag {
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid rgba(248,250,252,0.4);
      background: rgba(15,23,42,0.15);
    }

    .hero-right {
      position: relative;
      z-index: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .hero-illustration {
      width: 220px;
      height: 220px;
      border-radius: 999px;
      background:
        radial-gradient(circle at 30% 20%, #ffffff 0, #e0f2fe 32%, transparent 60%),
        radial-gradient(circle at 70% 80%, #fee2e2 0, #fecaca 25%, transparent 60%),
        linear-gradient(135deg, #1d4ed8, #f97316);
      box-shadow:
        0 18px 40px rgba(15,23,42,0.40),
        0 0 0 1px rgba(248,250,252,0.5);
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .hero-illustration-inner {
      width: 150px;
      height: 150px;
      border-radius: 40px;
      background: rgba(15,23,42,0.75);
      backdrop-filter: blur(6px);
      border: 1px solid rgba(248,250,252,0.4);
      display: grid;
      grid-template-rows: 1.5fr 1fr;
      overflow: hidden;
    }

    .hero-graph {
      position: relative;
      padding: 10px;
      display: flex;
      align-items: flex-end;
      gap: 6px;
    }

    .bar {
      flex: 1;
      border-radius: 999px 999px 3px 3px;
      background: linear-gradient(180deg, #4ade80, #15803d);
    }

    .bar:nth-child(2) {
      height: 60%;
      background: linear-gradient(180deg, #fbbf24, #b45309);
    }

    .bar:nth-child(3) {
      height: 85%;
    }

    .bar:nth-child(1) { height: 35%; }

    .hero-graph-label {
      position: absolute;
      top: 6px;
      left: 10px;
      font-size: 10px;
      color: #e5e7eb;
      opacity: 0.85;
    }

    .hero-bottom {
      border-top: 1px solid rgba(148,163,184,0.4);
      padding: 6px 10px 8px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      justify-content: center;
    }

    .hero-bottom-main {
      font-size: 12px;
      color: #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: baseline;
    }

    .hero-bottom-main strong {
      font-size: 14px;
      color: #fefce8;
    }

    .hero-bottom-sub {
      font-size: 10px;
      color: #9ca3af;
      display: flex;
      justify-content: space-between;
    }

    /* Calculator 카드 */
    .card {
      margin-top: 4px;
      border-radius: 20px;
      background: var(--card-bg);
      box-shadow:
        0 18px 40px rgba(15,23,42,0.08),
        0 0 0 1px rgba(148,163,184,0.20);
      border: 1px solid rgba(148,163,184,0.20);
      padding: 18px 20px 16px;
    }

    .card-headline {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 10px;
      gap: 10px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      letter-spacing: -0.02em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card-badge {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      border: 1px solid rgba(129,140,248,0.5);
    }

    .card-sub {
      font-size: 12px;
      color: var(--text-sub);
    }

    .section-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--text-main);
    }

    .section-desc {
      font-size: 11px;
      color: var(--text-sub);
      margin-bottom: 10px;
      line-height: 1.5;
    }

    .grid {
      display: grid;
      grid-template-columns: minmax(0, 1.05fr) minmax(0, 1.2fr);
      gap: 18px;
      margin-bottom: 14px;
    }

    .panel {
      background: #f9fafb;
      border-radius: 12px;
      padding: 10px 12px;
      border: 1px solid #e5e7eb;
    }

    .field-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }

    .field-label {
      min-width: 86px;
      font-size: 12px;
      color: var(--text-main);
      font-weight: 500;
    }

    .field-input {
      flex: 1;
      min-width: 0;
    }

    .field-input input {
      width: 100%;
      padding: 7px 9px;
      border-radius: 999px;
      border: 1px solid #d4d4dd;
      font-size: 13px;
      background-color: #ffffff;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background-color 0.15s ease;
    }

    .field-input input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(79,70,229,0.18);
      background-color: #ffffff;
    }

    .field-unit {
      font-size: 11px;
      color: var(--text-sub);
      min-width: 70px;
      text-align: right;
    }

    .hint {
      font-size: 11px;
      color: var(--text-sub);
      line-height: 1.5;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11.5px;
      margin-top: 4px;
    }

    thead {
      background: #f3f4f6;
    }

    th, td {
      padding: 5px 6px;
      border-bottom: 1px solid #e5e7eb;
      text-align: center;
    }

    th {
      font-weight: 600;
      color: #374151;
    }

    tbody tr:last-child td {
      border-bottom: 1px solid #e5e7eb;
    }

    tbody tr:nth-child(even) {
      background: #f9fafb;
    }

    td input {
      width: 100%;
      padding: 4px 6px;
      border-radius: 8px;
      border: 1px solid #d4d4dd;
      font-size: 11.5px;
      background: #ffffff;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
    }

    td input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(79,70,229,0.16);
    }

    td input[readonly] {
      background-color: #f3f4f6;
      color: #4b5563;
    }

    .loan-name-input {
      text-align: left;
    }

    .controls {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 8px;
    }

    button {
      cursor: pointer;
      border-radius: 999px;
      border: none;
      font-size: 11.5px;
      font-weight: 500;
      padding: 6px 12px;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      letter-spacing: 0.01em;
      transition: transform 0.05s ease, box-shadow 0.1s ease, background-color 0.1s ease;
    }

    button:active {
      transform: scale(0.98);
    }

    .btn-primary {
      background: var(--accent);
      color: #ffffff;
      box-shadow: 0 6px 14px rgba(79,70,229,0.35);
    }

    .btn-primary:hover {
      background: #4338ca;
    }

    .btn-outline {
      background: #ffffff;
      color: var(--text-main);
      border: 1px solid #d4d4dd;
    }

    .btn-outline:hover {
      background: #f3f4f6;
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-sub);
      border: 1px solid #e5e7eb;
    }

    .btn-ghost:hover {
      background: #f9fafb;
    }

    .results {
      margin-top: 12px;
      display: grid;
      grid-template-columns: 0.95fr 0.75fr 0.75fr 1.4fr; /* ✅ DSR + 서울보증DTI 추가로 4칸 */
      gap: 14px;
      padding: 10px 12px;
      border-radius: 14px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
    }

    .result-block { min-width: 0; }

    .result-label {
      font-size: 11px;
      color: var(--text-sub);
      margin-bottom: 3px;
    }

    .result-value {
      font-weight: 600;
      font-size: 14px;
      color: var(--text-main);
    }

    .dsr-number {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: -0.03em;
    }

    .dsr-safe   { color: var(--safe); }
    .dsr-warning{ color: var(--warning); }
    .dsr-danger { color: var(--danger); }

    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 2px 7px;
      border-radius: 999px;
      font-size: 10.5px;
      font-weight: 600;
      margin-left: 6px;
      border: 1px solid transparent;
    }

    .badge-safe {
      background-color: #ecfdf3;
      color: #166534;
      border-color: #bbf7d0;
    }

    .badge-warning {
      background-color: #fff7ed;
      color: #9a3412;
      border-color: #fed7aa;
    }

    .badge-danger {
      background-color: #fef2f2;
      color: #b91c1c;
      border-color: #fecaca;
    }

    .note {
      margin-top: 8px;
      font-size: 11px;
      color: var(--text-sub);
      line-height: 1.6;
    }

    @media (max-width: 900px) {
      .page {
        padding: 20px 10px;
      }
      .hero {
        grid-template-columns: minmax(0, 1fr);
        padding: 18px 16px;
      }
      .hero-right {
        justify-content: flex-start;
      }
      .card {
        padding: 16px 14px;
      }
      .grid {
        grid-template-columns: minmax(0, 1fr);
      }
      .results {
        grid-template-columns: minmax(0, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="shell">
      <!-- 상단 Hero 영역 -->
      <section class="hero">
        <div class="hero-left">
          <div class="hero-pill">
            <span class="hero-pill-dot"></span>
            실무자를 위한 DSR 시뮬레이터
          </div>
          <h1 class="hero-title">
            고객의 <span class="accent">부담 능력</span>을<br />
            한 화면에서 직관적으로 확인하세요.
          </h1>
          <p class="hero-subtitle">
            연 소득과 여러 건의 대출 정보를 한 번에 반영해, 연간 상환 부담과 DSR을 빠르게 확인할 수 있는 계산기입니다.
            상담·심사 전 사전 점검용으로 활용해 보세요.
          </p>
          <div class="hero-meta">
            <span class="hero-tag">연 단위 DSR</span>
            <span class="hero-tag">다중 대출 동시 반영</span>
            <span class="hero-tag">원리금 균등 상환 가정</span>
          </div>
        </div>
        <div class="hero-right">
          <div class="hero-illustration">
            <div class="hero-illustration-inner">
              <div class="hero-graph">
                <div class="hero-graph-label">연간 상환액</div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
              </div>
              <div class="hero-bottom">
                <div class="hero-bottom-main">
                  <span>예상 DSR</span>
                  <strong>32.7%</strong>
                </div>
                <div class="hero-bottom-sub">
                  <span>시뮬레이션 기준</span>
                  <span>Annual · Internal</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- DSR 계산기 카드 -->
      <section class="card">
        <div class="card-headline">
          <div class="card-title">
            DSR 계산기
            <span class="card-badge">계산 자동화</span>
          </div>
          <div class="card-sub">
            연 소득과 각 대출의 원금·금리·기간을 입력하면 연간 상환액과 DSR이 자동으로 산출됩니다.
          </div>
        </div>

        <!-- 1. 소득 입력 -->
        <div class="section-title">1. 소득 입력</div>
        <p class="section-desc">
          고객의 <strong>연 소득</strong>을 입력해 주세요. 숫자를 입력하면 자동으로 콤마와 <strong>원(₩)</strong> 단위로 표기됩니다.
        </p>

        <div class="grid">
          <div class="panel">
            <div class="field-row">
              <div class="field-label">연 소득</div>
              <div class="field-input">
                <input
                  type="text"
                  id="annualIncome"
                  placeholder="예: 80,000,000원"
                />
              </div>
              <div class="field-unit">연 기준</div>
            </div>

            <!-- ✅ 서울보증 DTI 입력 추가 -->
            <div class="field-row" style="margin-top: 10px;">
              <div class="field-label">기존 부채(합산)</div>
              <div class="field-input">
                <input type="text" id="existingDebt" placeholder="예: 480,000,000원" />
              </div>
              <div class="field-unit">원</div>
            </div>

            <div class="field-row">
              <div class="field-label">서울보증 적용금리</div>
              <div class="field-input">
                <input type="number" id="sgiRate" min="0" step="0.01" value="5" />
              </div>
              <div class="field-unit">%</div>
            </div>

            <p class="hint">
              · 예: <code>80000000</code> 입력 → <strong>80,000,000원</strong>으로 자동 포맷<br />
              · 계산 시에는 콤마·원(₩)을 제거한 숫자 값만 사용합니다.<br />
              · <strong>기존 부채(합산)</strong>은 현재 보유 부채(담보+신용 합산)이며, <strong>주담 실행예정은 미포함</strong>입니다.<br />
              · 서울보증 DTI는 <strong>(주담 실행예정 연간원리금 + 기존부채×적용금리)</strong>를 소득으로 나눠 산출합니다.
            </p>
          </div>

          <div class="panel">
            <div class="section-title" style="margin-bottom: 4px;">DSR 개념</div>
            <p class="hint">
              DSR은 <strong>연간 총 대출 상환액 ÷ 연 소득 × 100</strong>으로 정의됩니다.<br />
              이 계산기는 내부 상담·시뮬레이션용 참고 도구이며, 실제 심사 기준 및 정책과는 차이가 있을 수 있습니다.<br /><br />
              · 입력: 연 소득, 각 대출의 원금·이자율·기간<br />
              · 산식: <strong>원리금 균등 상환(연 단위)</strong> 가정
            </p>
          </div>
        </div>

        <!-- 2. 대출 정보 입력 -->
        <div class="section-title">2. 대출 정보 입력</div>
        <p class="section-desc">
          보유(또는 계획) 중인 대출 정보를 입력해 주세요. 필요 없는 행은 비워두셔도 됩니다.
        </p>
        <p class="hint">
          · <strong>대출 원금</strong>: 숫자 입력 시 자동으로 <strong>1,000,000원</strong> 형식으로 표기됩니다.<br />
          · <strong>연 이자율</strong>: 퍼센트(%) 단위, 예: 4.5% → <code>4.5</code><br />
          · <strong>기간</strong>: 연(Year) 단위, 예: 30년 → <code>30</code><br />
          · 서울보증 DTI의 “주담 실행예정”은 <strong>대출 종류에 ‘주택담보’가 포함된 첫 번째 행</strong>을 기준으로 계산합니다.
        </p>

        <table>
          <thead>
            <tr>
              <th style="width: 180px;">대출 종류</th>
              <th style="width: 170px;">대출 원금</th>
              <th style="width: 110px;">연 이자율 (%)</th>
              <th style="width: 90px;">기간 (년)</th>
              <th style="width: 190px;">연간 상환액 (원)</th>
            </tr>
          </thead>
          <tbody id="loanTableBody">
            <!-- JS에서 생성 -->
          </tbody>
        </table>

        <div class="controls">
          <button class="btn-ghost" type="button" onclick="addLoanRow()">+ 행 추가</button>
          <button class="btn-outline" type="button" onclick="clearAll()">초기화</button>
          <button class="btn-primary" type="button" onclick="calculateDSR()">DSR 계산하기</button>
        </div>

        <!-- 3. 결과 -->
        <div class="section-title">3. 결과</div>
        <div class="results">
          <div class="result-block">
            <div class="result-label">총 연간 상환액</div>
            <div class="result-value" id="totalAnnualPayment">0 원</div>
          </div>

          <div class="result-block">
            <div class="result-label">
              DSR (총부채원리금상환비율)
              <span id="dsrBadge" class="badge"></span>
            </div>
            <div class="dsr-number" id="dsrValue">0.00%</div>
          </div>

          <!-- ✅ 서울보증 DTI 결과 추가 -->
          <div class="result-block">
            <div class="result-label">
              서울보증 DTI
              <span id="sgiDtiBadge" class="badge"></span>
            </div>
            <div class="dsr-number" id="sgiDtiValue">0.00%</div>
          </div>

          <div class="result-block">
            <div class="result-label">진단 코멘트</div>
            <div class="result-value" id="dsrComment">
              연 소득 및 대출 정보를 입력한 후 [DSR 계산하기] 버튼을 눌러주세요.
            </div>
          </div>
        </div>

        <p class="note">
          · <strong>30% 미만</strong>: 비교적 안정적인 수준입니다. 추가 대출 여력은 있으나 상환 계획을 함께 검토하는 것이 좋습니다.<br />
          · <strong>30% ~ 40%</strong>: 주의 구간입니다. 추가 대출 승인·한도에 제약이 생길 수 있습니다.<br />
          · <strong>40% 이상</strong>: 위험 구간으로, 신규·추가 대출이 크게 제한될 수 있습니다.<br />
          · <strong>서울보증 DTI</strong>: 소수점 2자리 반올림 기준 <strong>40.00%까지 통과</strong>, <strong>40.01%부터 초과</strong>로 표시됩니다.
        </p>
      </section>
    </div>
  </div>

  <script>
    // 기본 대출 행 라벨
    const defaultLoans = [
      "주택담보대출 1",
      "주택담보대출 2",
      "신용대출 1",
      "신용대출 2",
      "전세자금대출",
      "자동차할부 / 리스",
      "카드론 / 기타대출",
      "비주택담보대출",
      "기타 (자유입력)"
    ];

    // "123,456원" 표시
    function formatMoneyDisplay(value) {
      const num = Number(value);
      if (!value || isNaN(num)) return "";
      return num.toLocaleString("ko-KR") + "원";
    }

    // 문자열 → 숫자
    function parseMoney(str) {
      if (!str) return 0;
      const cleaned = str.toString().replace(/[^0-9]/g, "");
      return Number(cleaned || 0);
    }

    function attachMoneyFormatter(input) {
      input.addEventListener("input", () => {
        const raw = parseMoney(input.value);
        input.value = raw ? formatMoneyDisplay(raw) : "";
      });
    }

    function createLoanRow(name = "") {
      const tr = document.createElement("tr");

      // 대출 종류
      const tdName = document.createElement("td");
      const inputName = document.createElement("input");
      inputName.type = "text";
      inputName.value = name;
      inputName.placeholder = "예: 주택담보대출";
      inputName.className = "loan-name-input";
      tdName.appendChild(inputName);

      // 원금
      const tdPrincipal = document.createElement("td");
      const inputPrincipal = document.createElement("input");
      inputPrincipal.type = "text";
      inputPrincipal.placeholder = "예: 100,000,000원";
      attachMoneyFormatter(inputPrincipal);
      tdPrincipal.appendChild(inputPrincipal);

      // 이자율
      const tdRate = document.createElement("td");
      const inputRate = document.createElement("input");
      inputRate.type = "number";
      inputRate.min = "0";
      inputRate.step = "0.01";
      inputRate.placeholder = "예: 4.5";
      tdRate.appendChild(inputRate);

      // 기간
      const tdYears = document.createElement("td");
      const inputYears = document.createElement("input");
      inputYears.type = "number";
      inputYears.min = "0";
      inputYears.placeholder = "예: 30";
      tdYears.appendChild(inputYears);

      // 연간 상환액
      const tdAnnualPayment = document.createElement("td");
      const inputAnnualPayment = document.createElement("input");
      inputAnnualPayment.type = "text";
      inputAnnualPayment.readOnly = true;
      inputAnnualPayment.placeholder = "자동 계산";
      tdAnnualPayment.appendChild(inputAnnualPayment);

      tr.appendChild(tdName);
      tr.appendChild(tdPrincipal);
      tr.appendChild(tdRate);
      tr.appendChild(tdYears);
      tr.appendChild(tdAnnualPayment);

      return tr;
    }

    function addLoanRow(name = "") {
      const tbody = document.getElementById("loanTableBody");
      const row = createLoanRow(name);
      tbody.appendChild(row);
    }

    function initDefaultRows() {
      const tbody = document.getElementById("loanTableBody");
      tbody.innerHTML = "";
      defaultLoans.forEach(label => addLoanRow(label));
    }

    // 원리금 균등 상환 연간 상환액
    function calcAnnualPayment(principal, annualRate, years) {
      if (principal <= 0 || years <= 0) return 0;
      const r = annualRate;
      if (r === 0) return principal / years;
      const pow = Math.pow(1 + r, years);
      return principal * r * pow / (pow - 1);
    }

    function formatNumber(num) {
      if (!isFinite(num)) return "0";
      return Math.round(num).toLocaleString("ko-KR");
    }

    function calculateDSR() {
      const incomeInput = document.getElementById("annualIncome");
      const annualIncome = parseMoney(incomeInput.value);

      // ✅ 서울보증 DTI 입력
      const existingDebt = parseMoney(document.getElementById("existingDebt").value);
      const sgiRatePercent = Number(document.getElementById("sgiRate").value || 5);
      const sgiRate = sgiRatePercent / 100;

      const tbody = document.getElementById("loanTableBody");
      const rows = Array.from(tbody.querySelectorAll("tr"));

      let totalAnnualPayment = 0;

      rows.forEach(row => {
        const inputs = row.querySelectorAll("input");
        const principalDisplay = inputs[1].value;
        const principal = parseMoney(principalDisplay);
        const ratePercent = Number(inputs[2].value || 0);
        const years = Number(inputs[3].value || 0);
        const annualPaymentField = inputs[4];

        const rate = ratePercent / 100;
        const annualPayment = calcAnnualPayment(principal, rate, years);

        annualPaymentField.value =
          annualPayment > 0 ? formatNumber(annualPayment) + "원" : "";
        totalAnnualPayment += annualPayment;
      });

      document.getElementById("totalAnnualPayment").textContent =
        formatNumber(totalAnnualPayment) + " 원";

      const dsrEl = document.getElementById("dsrValue");
      const badgeEl = document.getElementById("dsrBadge");
      const commentEl = document.getElementById("dsrComment");

      let dsr = 0;
      if (annualIncome > 0) {
        dsr = (totalAnnualPayment / annualIncome) * 100;
      }

      dsrEl.textContent = dsr.toFixed(2) + "%";
      dsrEl.classList.remove("dsr-safe", "dsr-warning", "dsr-danger");
      badgeEl.classList.remove("badge-safe", "badge-warning", "badge-danger");
      badgeEl.textContent = "";

      let comment = "";

      if (annualIncome <= 0) {
        comment = "연 소득을 먼저 입력해 주세요.";
      } else if (totalAnnualPayment <= 0) {
        comment = "대출 정보를 입력해 주세요.";
      } else {
        if (dsr < 30) {
          dsrEl.classList.add("dsr-safe");
          badgeEl.classList.add("badge-safe");
          badgeEl.textContent = "안정";
          comment = "비교적 안정적인 수준입니다. 다만 추가 대출 시 향후 상환 계획을 함께 검토하는 것이 좋습니다.";
        } else if (dsr < 40) {
          dsrEl.classList.add("dsr-warning");
          badgeEl.classList.add("badge-warning");
          badgeEl.textContent = "주의";
          comment = "주의 구간입니다. 추가 대출 한도 및 승인에 제약이 생길 수 있습니다.";
        } else {
          dsrEl.classList.add("dsr-danger");
          badgeEl.classList.add("badge-danger");
          badgeEl.textContent = "위험";
          comment = "위험 구간으로, 신규·추가 대출 승인 및 한도에 큰 제약이 있을 수 있습니다.";
        }
      }

      // ===== ✅ 서울보증 DTI 계산(엑셀 방식) =====
      // DTI = (주담 실행예정 연간원리금 + 기존부채 * 적용금리) / 연소득 * 100
      // 주담 실행예정: "주택담보"가 들어간 첫 행의 연간상환액(원리금) 사용
      let plannedMortgageAnnualPayment = 0;

      rows.forEach(row => {
        const inputs = row.querySelectorAll("input");
        const loanName = (inputs[0].value || "").trim();
        const annualPayment = parseMoney(inputs[4].value);
        if (!plannedMortgageAnnualPayment && loanName.includes("주택담보")) {
          plannedMortgageAnnualPayment = annualPayment;
        }
      });

      let sgiDti = 0;
      if (annualIncome > 0) {
        sgiDti = ((plannedMortgageAnnualPayment + (existingDebt * sgiRate)) / annualIncome) * 100;
      }

      const sgiDtiEl = document.getElementById("sgiDtiValue");
      const sgiBadgeEl = document.getElementById("sgiDtiBadge");

      if (sgiDtiEl && sgiBadgeEl) {
        // ✅ 소수점 2자리 반올림 기준으로 판정
        const sgiDtiRounded = Number(sgiDti.toFixed(2));
        sgiDtiEl.textContent = sgiDtiRounded.toFixed(2) + "%";

        sgiDtiEl.classList.remove("dsr-safe", "dsr-warning", "dsr-danger");
        sgiBadgeEl.classList.remove("badge-safe", "badge-warning", "badge-danger");
        sgiBadgeEl.textContent = "";

        if (annualIncome > 0 && sgiDtiRounded <= 40) {
          sgiDtiEl.classList.add("dsr-safe");
          sgiBadgeEl.classList.add("badge-safe");
          sgiBadgeEl.textContent = "통과(≤40%)";
        } else if (annualIncome > 0) {
          sgiDtiEl.classList.add("dsr-danger");
          sgiBadgeEl.classList.add("badge-danger");
          sgiBadgeEl.textContent = "초과(>40%)";
          if (comment) comment += " (서울보증 DTI 40% 초과 가능)";
        }
      }

      commentEl.textContent = comment;
    }

    function clearAll() {
      document.getElementById("annualIncome").value = "";
      document.getElementById("existingDebt").value = "";
      document.getElementById("sgiRate").value = "5";

      initDefaultRows();

      document.getElementById("totalAnnualPayment").textContent = "0 원";

      const dsrEl = document.getElementById("dsrValue");
      dsrEl.textContent = "0.00%";
      dsrEl.classList.remove("dsr-safe", "dsr-warning", "dsr-danger");

      const badgeEl = document.getElementById("dsrBadge");
      badgeEl.textContent = "";
      badgeEl.classList.remove("badge-safe", "badge-warning", "badge-danger");

      const sgiDtiEl = document.getElementById("sgiDtiValue");
      const sgiBadgeEl = document.getElementById("sgiDtiBadge");
      if (sgiDtiEl && sgiBadgeEl) {
        sgiDtiEl.textContent = "0.00%";
        sgiDtiEl.classList.remove("dsr-safe", "dsr-warning", "dsr-danger");
        sgiBadgeEl.textContent = "";
        sgiBadgeEl.classList.remove("badge-safe", "badge-warning", "badge-danger");
      }

      document.getElementById("dsrComment").textContent =
        "연 소득 및 대출 정보를 입력한 후 [DSR 계산하기] 버튼을 눌러주세요.";
    }

    window.addEventListener("DOMContentLoaded", () => {
      initDefaultRows();
      attachMoneyFormatter(document.getElementById("annualIncome"));
      attachMoneyFormatter(document.getElementById("existingDebt")); // ✅ 추가
    });
  </script>
</body>
</html>
