// ===================== DTI 전용 계산(추가만) =====================
function calculateDTIOnly() {
  const income = parseMoney(document.getElementById("dtiIncome").value);
  const existingDebt = parseMoney(document.getElementById("dtiExistingDebt").value);
  const sgiRate = Number(document.getElementById("dtiSgiRate").value || 5) / 100;

  const mPrincipal = parseMoney(document.getElementById("dtiMortgagePrincipal").value);
  const mRate = Number(document.getElementById("dtiMortgageRate").value || 0) / 100;
  const mYears = Number(document.getElementById("dtiMortgageYears").value || 0);

  const dtiEl = document.getElementById("dtiValue");
  const badgeEl = document.getElementById("dtiBadge");
  const commentEl = document.getElementById("dtiComment");

  // 안전장치: 필수 DOM이 없으면 종료
  if (!dtiEl || !badgeEl || !commentEl) return;

  // 입력 검증
  if (income <= 0) {
    dtiEl.textContent = "0.00%";
    dtiEl.classList.remove("dsr-safe", "dsr-warning", "dsr-danger");
    badgeEl.textContent = "";
    badgeEl.classList.remove("badge-safe", "badge-warning", "badge-danger");
    commentEl.textContent = "연 소득을 입력해 주세요.";
    return;
  }

  // 주담 연간원리금(기존 calcAnnualPayment() 재사용)
  const mortgageAnnual = calcAnnualPayment(mPrincipal, mRate, mYears);

  // 요청 산식: (주담 연간원리금 + 기존부채×적용금리) / 연소득 * 100
  const dti = ((mortgageAnnual + (existingDebt * sgiRate)) / income) * 100;
  const rounded = Number(dti.toFixed(2)); // 소수점 2자리 반올림 기준

  dtiEl.textContent = rounded.toFixed(2) + "%";

  dtiEl.classList.remove("dsr-safe", "dsr-warning", "dsr-danger");
  badgeEl.classList.remove("badge-safe", "badge-warning", "badge-danger");
  badgeEl.textContent = "";

  if (rounded <= 40) {
    dtiEl.classList.add("dsr-safe");
    badgeEl.classList.add("badge-safe");
    badgeEl.textContent = "통과(≤40%)";
    commentEl.textContent = "DTI 기준 통과 범위입니다(소수점 2자리 반올림 기준).";
  } else {
    dtiEl.classList.add("dsr-danger");
    badgeEl.classList.add("badge-danger");
    badgeEl.textContent = "초과(>40%)";
    commentEl.textContent = "DTI 기준 초과 가능성이 있습니다(소수점 2자리 반올림 기준).";
  }
}

function clearDTI() {
  const ids = [
    "dtiIncome",
    "dtiExistingDebt",
    "dtiMortgagePrincipal",
    "dtiMortgageRate",
    "dtiMortgageYears"
  ];
  ids.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = "";
  });

  const rateEl = document.getElementById("dtiSgiRate");
  if (rateEl) rateEl.value = "5";

  const dtiEl = document.getElementById("dtiValue");
  const badgeEl = document.getElementById("dtiBadge");
  const commentEl = document.getElementById("dtiComment");

  if (dtiEl) {
    dtiEl.textContent = "0.00%";
    dtiEl.classList.remove("dsr-safe", "dsr-warning", "dsr-danger");
  }
  if (badgeEl) {
    badgeEl.textContent = "";
    badgeEl.classList.remove("badge-safe", "badge-warning", "badge-danger");
  }
  if (commentEl) {
    commentEl.textContent = "값을 입력한 후 [DTI 계산하기]를 눌러주세요.";
  }
}
